<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>
           
        <record model="ir.ui.view" id="stock_inventory_location_form_view">
            <field name="name">stock.inventory.location.form</field>
            <field name="model">stock.inventory</field>
            <field name="inherit_id" ref="stock.view_inventory_form"/>
            <field name="priority" eval="10"/>
            <field name="arch" type="xml">
                <!-- Add type of inventory : partial or complete. -->
                <xpath expr="/form/field[@name='date']" position="after">
                    <field name="exhaustive"/>
                </xpath>

                <!-- Add panel of locations to be inventoried on exhaustive inventory --> 
                <xpath expr="/form//field[@name='inventory_line_id']" position="before">
                    <!-- Add the locations list for inventory -->
                    <field colspan="1" nolabel="1" name="location_ids" domain="[('usage','in',('view', 'internal'))]" attrs="{'invisible':[('exhaustive','!=',True)]}">
                        <tree string="Locations" editable="bottom">
                            <field name="name"/>
                        </tree>
                    </field>
                </xpath>                    

                <!-- Reorganize the screen colspan -->                                    
                <xpath expr="/form//field[@name='inventory_line_id']" position="attributes">
                    <attribute name="colspan">3</attribute>
                </xpath>                

                <!-- Control locations added by user on inventory line -->  
                <xpath expr="/form//field/tree/field[@name='location_id']" position="attributes">
                    <attribute name="on_change">onchange_location_id(parent.location_ids, parent.exhaustive, location_id)</attribute>
                </xpath>
                <xpath expr="/form//field/form/field[@name='location_id']" position="attributes">
                    <attribute name="on_change">onchange_location_id(parent.location_ids, parent.exhaustive, location_id)</attribute>
                </xpath>
                    
                <!-- Change states when the button is available --> 
                <xpath expr="/form//field/tree/button" position="attributes">
                    <attribute name="states">open</attribute>
                </xpath>
                
                <!-- Add button to open an inventory. Call wizard on confirm inventory -->
                <xpath expr="/form//button[@name='action_cancel_inventary']" position="replace">
                    <button name="action_cancel_inventary" states="draft,open,confirm,done" string="Cancel Inventory" type="object" icon="gtk-cancel"/>
                    <button name="action_open" states="draft" string="Open Inventory" type="object" icon="gtk-go-forward"/>
                </xpath>
                
                <!-- replace action_confirm button  -->
                <xpath expr="/form//button[@name='action_confirm']" position="replace">
                    <button name="%(action_view_stock_inventory_uninventoried_location)d"
                        string="Confirm Inventory" type="action" states="open" icon="gtk-apply"/>
                </xpath>
            </field>
        </record>

        <!-- Add filter for complete or partial inventory -->
        <record model="ir.ui.view" id="view_inventory_complete_filter">
            <field name="name">complete.inventory.filter</field>
            <field name="model">stock.inventory</field>
            <field name="type">search</field>
            <field name="inherit_id" ref="stock.view_inventory_filter"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='name']" position="before">
                    <filter icon="terp-check" name="exhaustive" string="Exhaustive" domain="[('exhaustive', '=', True)]" help="Only select inventories that have no parents." />
                    <separator orientation="vertical"/>
                </xpath>
            </field>
        </record>
        
        <!-- Show exhaustive inventories by default -->
        <record id="stock.action_inventory_form" model="ir.actions.act_window">
            <field name="context">{'full':'1', 'search_default_exhaustive':1}</field>
        </record>

	</data>
</openerp>